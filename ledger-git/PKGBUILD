# Based on PKGBUILD by: Nathan Jones <nathanj@insightbb.com>
# Contributor: Johann Kl√§hn <kljohann@gmail.com>

pkgname=ledger-git
pkgver=20090829
pkgrel=1
pkgdesc="CLI double-entry accounting tool"
depends=('gmp' 'pcre' 'expat' 'mpfr>=2.4.0' 'boost')
makedepends=('git' 'cvs')
url="http://www.newartisans.com/software/ledger.html"
license=('BSD')
arch=('any')
provides=('ledger')
conflicts=('ledger')
install=ledger.install
source=()
md5sums=()

_gitroot="git://github.com/jwiegley/ledger.git"
_gitname="ledger"

build() {
  cd $srcdir

  msg "Connecting to GIT server..."
  if [[ -d $_gitname ]]; then
    (cd $_gitname && git pull origin master)
  else
    git clone $_gitroot $_gitname
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf $_gitname-build
  cp -r $_gitname $_gitname-build
  cd $_gitname-build

  ./acprep submodule || return 1
  ./acprep -- --prefix=/usr || return 1
  make || return 1
  make DESTDIR=$startdir/pkg install || return 1

  rm -rf $startdir/pkg/usr/share/locale

  # handle the dir file in the install script
  rm -rf $startdir/pkg/usr/share/info/dir

  install -D -m644 $srcdir/$_gitname-build/doc/LICENSE $startdir/pkg/usr/share/licenses/custom/ledger/license.txt
}

